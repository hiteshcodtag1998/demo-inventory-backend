name: Deploy Node.js App to AWS Lightsail

on:
  push:
    branches:
      - master # Or any branch you want to deploy from

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v1
      with:
        node-version: '20' # Use the Node version your app requires

    - name: Install Dependencies
      run: npm install

    - name: Copy files to Lightsail
      uses: appleboy/scp-action@master
      with:
        host: 65.1.9.112
        username: "Ubuntu"
        key: "-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----"
        port: 22
        source: "."
        target: "/home/ubuntu/inventory-demo/demo-inventory-backend"

    - name: Restart Node.js app
      uses: appleboy/ssh-action@master
      with:
        host: 65.1.9.112
        username: "Ubuntu"
        key: "-----BEGIN OPENSSH PRIVATE KEY-----
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
-----END OPENSSH PRIVATE KEY-----"
        port: 22
        script: |
          cd /home/ubuntu/inventory-demo/demo-inventory-backend
          npm install --production
          pm2 restart all # or your specific start command
